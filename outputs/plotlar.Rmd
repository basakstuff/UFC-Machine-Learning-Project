---
title: "Plots"
output:
  pdf_document: 
   latex_engine: xelatex
  html_notebook: default
  html_document:
    df_print: paged
---

## Libraries and Data

```{r}
load.libraries <- c('data.table', 'testthat', 'gridExtra', 'corrplot', 'GGally', 'ggplot2', 'e1071', 'dplyr')
install.lib <- load.libraries[!load.libraries %in% installed.packages()]
for(libs in install.lib) install.packages(libs, dependences = TRUE)
sapply(load.libraries, require, character = TRUE)
library(data.table)
library(ggplot2) #data visualization
library(plotly) #interactive data visualization
library(psych) #correlation visualization helping
library(rattle) #graphing decesiion trees
library(caret) # machine learning
library(tree)
library(e1071)
library(rpart)
library(magrittr) # needs to be run every time you start R and want to use %>%
library(dplyr)    # alternatively, this also loads %>%
library(class)
library(formattable)
library(funModeling) 
library(tidyverse) 
library(Hmisc)
data <- read.csv("C:/Users/basak/Desktop/ml project/UFC-Machine-Learning-Project/data.csv")
setDT(data)
```
### Missing Value plot
```{r}
plot_Missing <- function(data_in, title = NULL){
  temp_df <- as.data.frame(ifelse(is.na(data_in), 0, 1))
  temp_df <- temp_df[,order(colSums(temp_df))]
  data_temp <- expand.grid(list(x = 1:nrow(temp_df), y = colnames(temp_df)))
  data_temp$m <- as.vector(as.matrix(temp_df))
  data_temp <- data.frame(x = unlist(data_temp$x), y = unlist(data_temp$y), m = unlist(data_temp$m))
  ggplot(data_temp) + geom_tile(aes(x=x, y=y, fill=factor(m))) + scale_fill_manual(values=c("white", "black"), name="Missing\n(0=Yes, 1=No)") + theme_light() + ylab("") + xlab("") + ggtitle(title)
}
```

### Selected features covering post 2010

```{r}
df1 <- data %>%
  select(date, Winner, title_bout, weight_class,B_fighter, B_Height_cms, B_Reach_cms, B_age, B_current_lose_streak, B_current_win_streak,B_longest_win_streak, B_losses,B_wins,B_total_rounds_fought, B_total_title_bouts,B_win_by_KO.TKO,B_win_by_Submission, B_win_by_Decision_Majority,B_win_by_Decision_Split,B_win_by_Decision_Unanimous,B_win_by_TKO_Doctor_Stoppage,
         R_fighter, R_Height_cms, R_Reach_cms, R_age,
         R_current_lose_streak, R_current_win_streak,R_longest_win_streak, R_losses,R_wins,R_total_rounds_fought,
         R_total_title_bouts,R_win_by_KO.TKO,R_win_by_Submission,
         R_win_by_Decision_Majority,R_win_by_Decision_Split,R_win_by_Decision_Unanimous,R_win_by_TKO_Doctor_Stoppage)


df1 <- subset.data.frame(df1, subset= date >= "2010-01-01")
```
*Dimension of new dataset*
```{r}
dim(df1)
```
*Null Value Plot*
```{r}
plot_Missing(df1[,colSums(is.na(df1)) >= 0, with = FALSE])
```
### Detection of null values
```{r}
cat_var1 <- names(df1)[which(sapply(df1, is.character))] #kategorik
numeric_var1 <- names(df1)[which(sapply(df1, is.numeric))] #numeric
colSums(sapply(df1[,.SD, .SDcols = cat_var1], is.na))
colSums(sapply(df1[,.SD, .SDcols = numeric_var1], is.na)) #numericte null kontrolu
```
###New dataset where null values are deleted
```{r}
df2 <- na.omit(df1) ##null rowlari sildi

cat_var2 <- names(df2)[which(sapply(df2, is.character))] #kategorik
numeric_var2 <- names(df2)[which(sapply(df2, is.numeric))] #numeric
colSums(sapply(df2[,.SD, .SDcols = cat_var2], is.na)) #kategorikte null kontrolu
colSums(sapply(df2[,.SD, .SDcols = numeric_var2], is.na)) #numericte null kontrolu
```
*Dimension of final dataset*
```{r}
dim(df1)
```

*Null Value Plot of final dataset*
```{r}
plot_Missing(df2[,colSums(is.na(df2)) >= 0, with = FALSE])
```
### Visualization of numeric column information
```{r}
plot_num(df2)
```
### Histogram for Blue Fighter Reach Difference
```{r}
ggplot(df2, aes(x=(B_Reach_cms - R_Reach_cms), y =..density.., fill=..count..)) + geom_histogram(binwidth = 5, ) + labs(x = "Reach Difference (cm)", title = "Histogram for Blue Fighter Reach Difference") + scale_fill_gradient("Count", low="#87CEEB", high="#00008B")
```
### Histogram for Red Fighter Reach Difference
```{r}
ggplot(df2, aes(x=(R_Reach_cms - B_Reach_cms), y =..density.., fill=..count..)) + geom_histogram(binwidth = 5, ) + labs(x = "Reach Difference (cm)", title = "Histogram for Red Fighter Reach Difference") + scale_fill_gradient("Count", low="#FFA07A", high="#FF0000")
```
### Barplot of Blue Fighter Age
```{r}
ggplot(df2, aes(x = B_age)) + geom_bar(fill = "#0000FF") #B_age
```
### Barplot of Blue Fighter Age
```{r}
ggplot(df2, aes(x = R_age)) + geom_bar(fill = "#FF0000") #R_age
```

### List of Blue fighter's winning average
```{r}
temp <- df2 %>% select(B_fighter,B_wins)
temp <- temp %>% group_by(B_fighter) %>% summarise(avg=mean(B_wins))
temp <- temp %>% arrange(desc(avg))
temp <- temp[1:10,]
temp %>%
  formattable(list(avg = color_bar("#85C1E9")), align = 'l')
```
### List of Red fighter's winning average
```{r}
temp <- df2 %>% select(R_fighter,R_wins)
temp <- temp %>% group_by(R_fighter) %>% summarise(avg=mean(R_wins))
temp <- temp %>% arrange(desc(avg))
temp <- temp[1:10,]
temp %>%
  formattable(list(avg = color_bar("#FF0000")), align = 'l')
```
##The winning Blue fighter according to weight_class
```{r}
df2 %>% filter(Winner == "Blue") %>% count(weight_class) #weight_class'a göre kazanan blue
```
##The winning Red fighter according to weight_class
```{r}
df2 %>% filter(Winner == "Red") %>% count(weight_class) #weight_class'a göre kazanan red
```
### Splitting columns containing numeric data
```{r}
numeric_data <- select_if(df2, is.numeric)
summary(numeric_data)
```
### Correlation Matrix
* *Korelasyonun büyüklüğü (0-1) iki değişken arasındaki ilişkinin gücünü*
*gösterirken işareti (+,-) değişkenlerin aynı yönde (+) artıp azaldığını*
*ya da zıt yönlerde (-) artış ve azalış gösterdiğini belirtir.*
*Eğer iki değişken arasında hiç ilişki yoksa korelasyon katsayısı sıfır ya da sıfıra yakın bulunur.*
*• Eğer iki değişken birbiriyle yüzde yüz oranında ilişkili ise korelasyon maksimum (1) değeri (mükemmel ilişki) alır.*
*r<0.20 ve sıfıra yakın değerler ilişkinin olmadığı ya da çok zayıf ilişkiyi işaret eder.*
  *• 0.20-0.39 arasında ise zayıf ilişki*
  *• 0.40-0.59 arasında ise orta düzeyde ilişki*
  *• 0.60-0.79 arasında ise yüksek düzeyde ilişki*
  *• 0.80-1.0 ise çok yüksek ilişki olduğu yorumu yapılır.*
  
*+1,00′ a yaklaştıkça iki değişken arasında aynı yöndeki ilişki artar.Değişkenlerden biri artarken diğeri de artar.*
*-1,00′ a yaklaştıkça iki değişen arasında ters yönde ilişki artar. Değişkenlerden biri artarken diğeri azalır.*
*0,00’a yaklaştıkça iki değişken arasındaki ilişki azalır.*
```{r}
cor_data <- cor(numeric_data)
corrplot(cor_data, method = "color", type = "upper", tl.col = "black", order="hclust")
```
### Pie chart showing the winning fighter
```{r}
custom_col <- c("blue", "green", "red") 
ggplot(df2, aes(x = "", y="", fill = factor(Winner))) + 
  geom_bar(width = 1, stat = "identity") +
  theme(axis.line = element_blank(), 
        plot.title = element_text(hjust=0.5,size=22)) + 
  labs(fill="Winner", 
       x=NULL, 
       y=NULL, 
       title="Pie Chart of Winners") + coord_polar(theta = "y", start=0)+
  scale_fill_manual(values=custom_col)
```